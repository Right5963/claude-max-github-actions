#!/bin/bash
# éš ã‚ŒãŸå®ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "ğŸ¯ éš ã‚ŒãŸå®ã‚·ã‚¹ãƒ†ãƒ çµ±åˆå®Ÿè¡Œ"
echo "=================================="
date

# 1. å¸‚å ´ã®æœ¬è³ªåˆ†æï¼ˆé€±æ¬¡å®Ÿè¡Œæ¨å¥¨ï¼‰
echo -e "\nğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—1: å¸‚å ´ã®æœ¬è³ªåˆ†æ"
echo "------------------------------"
python3 popularity_research.py > "reports/market_insights_$(date +%Y%m%d).txt"
echo "âœ… å¸‚å ´åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†"

# 2. ä¾¡æ ¼æˆ¦ç•¥ã®æ€è€ƒè£œåŠ©ï¼ˆä¾¡æ ¼å¤‰æ›´æ¤œè¨æ™‚ï¼‰
echo -e "\nğŸ§  ã‚¹ãƒ†ãƒƒãƒ—2: ä¾¡æ ¼æˆ¦ç•¥ã®æ€è€ƒè£œåŠ©"
echo "---------------------------------"
current_price=$(grep "å¹³å‡ä¾¡æ ¼" yahoo_simple_result.json 2>/dev/null | grep -o '[0-9]\+' | head -1 || echo "2800")
python3 thinking_core_simple.py "ç¾åœ¨ã®ä¾¡æ ¼${current_price}å††ã¯é©åˆ‡ã‹" > "reports/price_thinking_$(date +%Y%m%d).txt"
echo "âœ… ä¾¡æ ¼æˆ¦ç•¥æ€è€ƒåˆ†æå®Œäº†"

# 3. ä¾¡å€¤å‰µé€ ã‚µã‚¤ã‚¯ãƒ«ã®ç†è§£ï¼ˆæœˆæ¬¡å®Ÿè¡Œæ¨å¥¨ï¼‰
echo -e "\nğŸ”„ ã‚¹ãƒ†ãƒƒãƒ—3: ä¾¡å€¤å‰µé€ ã‚µã‚¤ã‚¯ãƒ«åˆ†æ"
echo "-----------------------------------"
python3 value_creation_cycle_analysis.py > "reports/value_cycle_$(date +%Y%m%d).txt"
echo "âœ… ä¾¡å€¤å‰µé€ ã‚µã‚¤ã‚¯ãƒ«åˆ†æå®Œäº†"

# 4. å£²ã‚Œç­‹ç”»åƒã®ãƒªã‚µãƒ¼ãƒåˆ†æï¼ˆå¸¸æ™‚æœ‰ç”¨ï¼‰
echo -e "\nğŸ¨ ã‚¹ãƒ†ãƒƒãƒ—4: å£²ã‚Œã‚‹ç”»åƒã®æœ¬è³ªåˆ†æ"
echo "-----------------------------------"
python3 selling_image_research.py > "reports/image_research_$(date +%Y%m%d).txt"
echo "âœ… å£²ã‚Œã‚‹ç”»åƒç ”ç©¶ãƒ¬ãƒãƒ¼ãƒˆå®Œäº†"

# 5. çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆ
echo -e "\nğŸ“ ã‚¹ãƒ†ãƒƒãƒ—5: çµ±åˆã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ¬ãƒãƒ¼ãƒˆ"
echo "-------------------------------------"
cat > "reports/integrated_insights_$(date +%Y%m%d).md" << EOF
# çµ±åˆã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
ç”Ÿæˆæ—¥: $(date +"%Y-%m-%d %H:%M")

## 1. å¸‚å ´ã®æœ¬è³ªï¼ˆpopularity_research.py ã‚ˆã‚Šï¼‰
$(tail -20 "reports/market_insights_$(date +%Y%m%d).txt" | head -10)

## 2. ä¾¡æ ¼æˆ¦ç•¥ã®è€ƒå¯Ÿï¼ˆthinking_core_simple.py ã‚ˆã‚Šï¼‰
$(tail -10 "reports/price_thinking_$(date +%Y%m%d).txt")

## 3. ä¾¡å€¤å‰µé€ ã®åŸå‰‡ï¼ˆvalue_creation_cycle_analysis.py ã‚ˆã‚Šï¼‰
$(grep -A 5 "åŸå‰‡" "reports/value_cycle_$(date +%Y%m%d).txt" | head -10)

## 4. ä»Šé€±ã®æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
1. å¸‚å ´åˆ†æã«åŸºã¥ãä¾¡æ ¼èª¿æ•´
2. ä¾¡å€¤å‰µé€ ã‚µã‚¤ã‚¯ãƒ«ã®å®Ÿè·µ
3. å£²ã‚Œç­‹è¦ç´ ã®ç”»åƒç”Ÿæˆã¸ã®åæ˜ 
EOF

echo "âœ… çµ±åˆã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†"

# 6. ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª
echo -e "\nğŸ“ ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆ:"
echo "----------------------"
ls -la reports/*_$(date +%Y%m%d).*

echo -e "\nâœ¨ éš ã‚ŒãŸå®ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆå®Ÿè¡Œå®Œäº†ï¼"
echo "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: reports/integrated_insights_$(date +%Y%m%d).md ã‚’ç¢ºèª"